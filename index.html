<!DOCTYPE html>
<html lang="zh-HK">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>記事日曆 Web App</title>
  <style>
    body { font-family: 'Arial', sans-serif; background: #f8f8f8; padding: 20px; }
    h1 { text-align: center; }
    #calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 20px; }
    .day { background: white; padding: 10px; border: 1px solid #ccc; cursor: pointer; min-height: 60px; position: relative; }
    .today { background: #ffdddd; }
    .event-mark { font-size: 10px; background: #cde; padding: 2px 4px; border-radius: 4px; margin-top: 5px; display: inline-block; }
    #eventBox { margin-top: 20px; display: none; }
    #eventBox textarea { width: 100%; height: 60px; margin-top: 5px; }
    button { margin-top: 10px; margin-right: 5px; }
  </style>
</head>
<body>
  <h1>🗓️ 記事日曆 Web App</h1>
  <div>
    <label for="month">選擇月份：</label>
    <select id="month"></select>
    <label for="year">選擇年份：</label>
    <select id="year"></select>
  </div>
  <div id="calendar"></div>
  <div id="eventBox">
    <h2 id="selectedDate">記事</h2>
    <label>開始時間：<input type="time" id="startTime"></label><br/>
    <label>結束時間：<input type="time" id="endTime"></label><br/>
    <textarea id="eventText" placeholder="輸入記事內容..."></textarea><br/>
    <label><input type="checkbox" id="holiday"> 放假</label>
    <label><input type="checkbox" id="busy"> 繁忙</label><br/>
    <button onclick="saveEvent()">儲存</button>
    <button onclick="deleteEvent()">刪除</button>
  </div>
  <script>
    const calendar = document.getElementById("calendar");
    const monthSelect = document.getElementById("month");
    const yearSelect = document.getElementById("year");
    const today = new Date();
    const eventBox = document.getElementById("eventBox");
    let selectedKey = "";

    function fillSelectOptions() {
      for (let m = 0; m < 12; m++) {
        const opt = document.createElement("option");
        opt.value = m;
        opt.textContent = m + 1;
        if (m === today.getMonth()) opt.selected = true;
        monthSelect.appendChild(opt);
      }
      for (let y = today.getFullYear() - 5; y <= today.getFullYear() + 5; y++) {
        const opt = document.createElement("option");
        opt.value = y;
        opt.textContent = y;
        if (y === today.getFullYear()) opt.selected = true;
        yearSelect.appendChild(opt);
      }
    }

    function renderCalendar() {
      calendar.innerHTML = "";
      const year = parseInt(yearSelect.value);
      const month = parseInt(monthSelect.value);
      const days = new Date(year, month + 1, 0).getDate();

      for (let i = 1; i <= days; i++) {
        const key = `${year}-${month+1}-${i}`;
        const div = document.createElement("div");
        div.className = "day";
        if (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
          div.classList.add("today");
        }
        div.innerHTML = `<strong>${i}</strong>`;
        const event = JSON.parse(localStorage.getItem(key) || "{}");
        if (event.text) {
          div.innerHTML += `<div class="event-mark">${event.start || ""} ${event.text}</div>`;
        }
        if (event.holiday) {
          div.style.border = "2px solid red";
        }
        div.onclick = () => showEventBox(key, year, month+1, i, event);
        calendar.appendChild(div);
      }
    }

    function showEventBox(key, y, m, d, data) {
      selectedKey = key;
      document.getElementById("selectedDate").textContent = `📑 ${y}-${m}-${d}`;
      document.getElementById("startTime").value = data.start || "";
      document.getElementById("endTime").value = data.end || "";
      document.getElementById("eventText").value = data.text || "";
      document.getElementById("holiday").checked = !!data.holiday;
      document.getElementById("busy").checked = !!data.busy;
      eventBox.style.display = "block";
    }

    function saveEvent() {
      const data = {
        start: document.getElementById("startTime").value,
        end: document.getElementById("endTime").value,
        text: document.getElementById("eventText").value.trim(),
        holiday: document.getElementById("holiday").checked,
        busy: document.getElementById("busy").checked
      };
      localStorage.setItem(selectedKey, JSON.stringify(data));
      eventBox.style.display = "none";
      renderCalendar();
    }

    function deleteEvent() {
      localStorage.removeItem(selectedKey);
      eventBox.style.display = "none";
      renderCalendar();
    }

    fillSelectOptions();
    monthSelect.onchange = renderCalendar;
    yearSelect.onchange = renderCalendar;
    renderCalendar();
  </script>
</body>
</html>
